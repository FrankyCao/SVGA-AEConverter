var Matrix=function(){function t(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function r(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1)}function s(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(1,0,0,0,0,r,-s,0,0,s,r,0,0,0,0,1)}function o(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,0,s,0,0,1,0,0,-s,0,r,0,0,0,0,1)}function p(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1)}function i(t,r){return this._t(1,r,t,1,0,0)}function e(t,r){return this.shear(Math.tan(t),Math.tan(r))}function a(t,r){var s=Math.cos(r),o=Math.sin(r);return this._t(s,o,0,0,-o,s,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1)._t(s,-o,0,0,o,s,0,0,0,0,1,0,0,0,0,1)}function h(t,r,s){return s=isNaN(s)?1:s,1==t&&1==r&&1==s?this:this._t(t,0,0,0,0,r,0,0,0,0,s,0,0,0,0,1)}function n(t,r,s,o,p,i,e,a,h,n,u,c,f,l,m,v){return this.props[0]=t,this.props[1]=r,this.props[2]=s,this.props[3]=o,this.props[4]=p,this.props[5]=i,this.props[6]=e,this.props[7]=a,this.props[8]=h,this.props[9]=n,this.props[10]=u,this.props[11]=c,this.props[12]=f,this.props[13]=l,this.props[14]=m,this.props[15]=v,this}function u(t,r,s){return s=isNaN(s)?0:s,0!==t||0!==r||0!==s?this._t(1,0,0,0,0,1,0,0,0,0,1,0,t,r,s,1):this}function c(t,r,s,o,p,i,e,a,h,n,u,c,f,l,m,v){if(1===t&&0===r&&0===s&&0===o&&0===p&&1===i&&0===e&&0===a&&0===h&&0===n&&1===u&&0===c)return 0===f&&0===l&&0===m||(this.props[12]=this.props[12]*t+this.props[13]*p+this.props[14]*h+this.props[15]*f,this.props[13]=this.props[12]*r+this.props[13]*i+this.props[14]*n+this.props[15]*l,this.props[14]=this.props[12]*s+this.props[13]*e+this.props[14]*u+this.props[15]*m,this.props[15]=this.props[12]*o+this.props[13]*a+this.props[14]*c+this.props[15]*v),this;var y=this.props[0],g=this.props[1],d=this.props[2],x=this.props[3],j=this.props[4],w=this.props[5],S=this.props[6],T=this.props[7],b=this.props[8],_=this.props[9],M=this.props[10],P=this.props[11],A=this.props[12],O=this.props[13],N=this.props[14],D=this.props[15];return this.props[0]=y*t+g*p+d*h+x*f,this.props[1]=y*r+g*i+d*n+x*l,this.props[2]=y*s+g*e+d*u+x*m,this.props[3]=y*o+g*a+d*c+x*v,this.props[4]=j*t+w*p+S*h+T*f,this.props[5]=j*r+w*i+S*n+T*l,this.props[6]=j*s+w*e+S*u+T*m,this.props[7]=j*o+w*a+S*c+T*v,this.props[8]=b*t+_*p+M*h+P*f,this.props[9]=b*r+_*i+M*n+P*l,this.props[10]=b*s+_*e+M*u+P*m,this.props[11]=b*o+_*a+M*c+P*v,this.props[12]=A*t+O*p+N*h+D*f,this.props[13]=A*r+O*i+N*n+D*l,this.props[14]=A*s+O*e+N*u+D*m,this.props[15]=A*o+O*a+N*c+D*v,this}function f(t){var r;for(r=0;r<16;r+=1)t.props[r]=this.props[r]}function l(t){var r;for(r=0;r<16;r+=1)this.props[r]=t[r]}function m(t,r,s){return{x:t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12],y:t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13],z:t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]}}function v(t,r,s){return t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12]}function y(t,r,s){return t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13]}function g(t,r,s){return t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]}function d(t,r,s){return[t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12],t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13],t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]]}function x(t,r){return bm_rnd(t*this.props[0]+r*this.props[4]+this.props[12])+","+bm_rnd(t*this.props[1]+r*this.props[5]+this.props[13])}function j(){return[this.props[0],this.props[1],this.props[2],this.props[3],this.props[4],this.props[5],this.props[6],this.props[7],this.props[8],this.props[9],this.props[10],this.props[11],this.props[12],this.props[13],this.props[14],this.props[15]]}function w(){return isSafari?"matrix3d("+roundTo2Decimals(this.props[0])+","+roundTo2Decimals(this.props[1])+","+roundTo2Decimals(this.props[2])+","+roundTo2Decimals(this.props[3])+","+roundTo2Decimals(this.props[4])+","+roundTo2Decimals(this.props[5])+","+roundTo2Decimals(this.props[6])+","+roundTo2Decimals(this.props[7])+","+roundTo2Decimals(this.props[8])+","+roundTo2Decimals(this.props[9])+","+roundTo2Decimals(this.props[10])+","+roundTo2Decimals(this.props[11])+","+roundTo2Decimals(this.props[12])+","+roundTo2Decimals(this.props[13])+","+roundTo2Decimals(this.props[14])+","+roundTo2Decimals(this.props[15])+")":(this.cssParts[1]=this.props.join(","),this.cssParts.join(""))}function S(){return"matrix("+this.props[0]+","+this.props[1]+","+this.props[4]+","+this.props[5]+","+this.props[12]+","+this.props[13]+")"}function T(){return""+this.toArray()}return function(){this.reset=t,this.rotate=r,this.rotateX=s,this.rotateY=o,this.rotateZ=p,this.skew=e,this.skewFromAxis=a,this.shear=i,this.scale=h,this.setTransform=n,this.translate=u,this.transform=c,this.applyToPoint=m,this.applyToX=v,this.applyToY=y,this.applyToZ=g,this.applyToPointArray=d,this.applyToPointStringified=x,this.toArray=j,this.toCSS=w,this.to2dCSS=S,this.toString=T,this.clone=f,this.cloneFromProps=l,this._t=this.transform,this.props=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.cssParts=["matrix3d(","",")"]}}();"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var r=meta[t];return"string"==typeof r?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,r){var s,o,p,i,e,a=gap,h=r[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),"function"==typeof rep&&(h=rep.call(r,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,e=[],"[object Array]"===Object.prototype.toString.apply(h)){for(i=h.length,s=0;s<i;s+=1)e[s]=str(s,h)||"null";return p=0===e.length?"[]":gap?"[\n"+gap+e.join(",\n"+gap)+"\n"+a+"]":"["+e.join(",")+"]",gap=a,p}if(rep&&"object"==typeof rep)for(i=rep.length,s=0;s<i;s+=1)"string"==typeof rep[s]&&(o=rep[s],p=str(o,h),p&&e.push(quote(o)+(gap?": ":":")+p));else for(o in h)Object.prototype.hasOwnProperty.call(h,o)&&(p=str(o,h),p&&e.push(quote(o)+(gap?": ":":")+p));return p=0===e.length?"{}":gap?"{\n"+gap+e.join(",\n"+gap)+"\n"+a+"}":"{"+e.join(",")+"}",gap=a,p}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,r,s){var o;if(gap="",indent="","number"==typeof s)for(o=0;o<s;o+=1)indent+=" ";else"string"==typeof s&&(indent=s);if(rep=r,r&&"function"!=typeof r&&("object"!=typeof r||"number"!=typeof r.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,r){var s,o,p=t[r];if(p&&"object"==typeof p)for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(o=walk(p,s),void 0!==o?p[s]=o:delete p[s]);return reviver.call(t,r,p)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var SVGA;!function(t){var r=function(){function t(t){this.app=void 0,this.proj=void 0,this.res=[],this.layers=[],this.app=t,this.loadProj(),this.loadRes(t.project.activeItem.layers,t.project.activeItem.layers.length),this.loadLayer(t.project.activeItem.layers,t.project.activeItem.layers.length,void 0,void 0,void 0)}return t.prototype.loadProj=function(){this.proj={name:this.app.project.activeItem.name,width:this.app.project.activeItem.width,height:this.app.project.activeItem.height,frameRate:this.app.project.activeItem.frameRate,frameCount:this.app.project.activeItem.frameRate*this.app.project.activeItem.duration}},t.prototype.loadRes=function(t,r){for(var s=1;s<=t.length;s++){var o=t[s];o.enabled!==!1&&(o.source&&o.source.file?this.res.push({name:o.source.name,path:o.source.file.fsName}):o.source.numLayers>0&&this.loadRes(o.source.layers,o.source.numLayers))}},t.prototype.loadLayer=function(t,r,s,o,p){for(var i=1;i<=r;i++){var e=t[i];e.enabled!==!1&&(e.source&&e.source.file?s?this.layers.push({name:e.source.name,values:this.concatValues(s,{alpha:this.requestAlpha(e.transform.opacity,e.inPoint,e.outPoint),layout:this.requestLayout(e.width,e.height),matrix:this.requestMatrix(e.transform,e.width,e.height)},e.width,e.height,o,p)}):this.layers.push({name:e.source.name,values:{alpha:this.requestAlpha(e.transform.opacity,e.inPoint,e.outPoint),layout:this.requestLayout(e.width,e.height),matrix:this.requestMatrix(e.transform,e.width,e.height)}}):e.source.numLayers>0&&this.loadLayer(e.source.layers,e.source.numLayers,{alpha:this.requestAlpha(e.transform.opacity,e.inPoint,e.outPoint),layout:this.requestLayout(e.width,e.height),matrix:this.requestMatrix(e.transform,e.width,e.height)},e.inPoint,e.outPoint))}},t.prototype.concatValues=function(t,r,s,o,p,i){var e=JSON.parse(JSON.stringify(t)),a=Math.min(p,i),h=Math.round(a/(1/this.proj.frameRate));h<0&&(h=0);for(var n=h,u=0;u<r.alpha.length;n++,u++)e.alpha[n]=r.alpha[u]*t.alpha[n];for(var n=h,u=0;u<r.layout.length;n++,u++)e.layout[n]=r.layout[u];for(var n=h,u=0;u<r.matrix.length&&n<t.matrix.length;n++,u++){var c=new Matrix;c.reset(),c.transform(r.matrix[u].a,r.matrix[u].b,0,0,r.matrix[u].c,r.matrix[u].d,0,0,0,0,0,0,r.matrix[u].tx,r.matrix[u].ty,0,0),c.transform(t.matrix[n].a,t.matrix[n].b,0,0,t.matrix[n].c,t.matrix[n].d,0,0,0,0,0,0,0,0,0,0),e.matrix[n]={a:c.props[0],b:c.props[1],c:c.props[4],d:c.props[5],tx:c.props[12]+t.matrix[n].tx,ty:c.props[13]+t.matrix[n].ty}}for(var f=0;f<h;f++)delete e.alpha[f],delete e.layout[f],delete e.matrix[f];return e},t.prototype.requestAlpha=function(t,r,s){for(var o=[],p=1/this.proj.frameRate,i=0;i<p*this.proj.frameCount;i+=p){if(r>s){if(i>r||i<s){o.push(0);continue}}else if(r<s&&(i<r||i>s)){o.push(0);continue}o.push(t.valueAtTime(i,!0)/100)}return o},t.prototype.requestMatrix=function(t,r,s){for(var o=[],p=1/this.proj.frameRate,i=0;i<p*this.proj.frameCount;i+=p){var e=t.Rotation.valueAtTime(i,!0),a=(t["Anchor Point"].valueAtTime(i,!0)[0],t["Anchor Point"].valueAtTime(i,!0)[1],t.Scale.valueAtTime(i,!0)[0]/100),h=t.Scale.valueAtTime(i,!0)[1]/100,n=t.Position.valueAtTime(i,!0)[0],u=t.Position.valueAtTime(i,!0)[1],c=new Matrix;c.reset().rotate(e*Math.PI/180).scale(a,h),this.convertMatrix(c,0,0,r,s,n,u),o.push({a:c.props[0],b:c.props[1],c:c.props[4],d:c.props[5],tx:c.props[12],ty:c.props[13]})}return o},t.prototype.requestLayout=function(t,r){for(var s=[],o=1/this.proj.frameRate,p=0;p<o*this.proj.frameCount;p+=o)s.push({x:0,y:0,width:t,height:r});return s},t.prototype.convertMatrix=function(t,r,s,o,p,i,e){var a=t.props[0]*r+t.props[4]*s+r,h=t.props[0]*(r+o)+t.props[4]*s+r,n=t.props[0]*r+t.props[4]*(s+p)+r,u=t.props[0]*(r+o)+t.props[4]*(s+p)+r,c=t.props[1]*r+t.props[5]*s+s,f=t.props[1]*(r+o)+t.props[5]*s+s,l=t.props[1]*r+t.props[5]*(s+p)+s,m=t.props[1]*(r+o)+t.props[5]*(s+p)+s,v=(Math.min(a,h,n,u)+Math.max(a,h,n,u))/2,y=(Math.min(c,f,l,m)+Math.max(c,f,l,m))/2;t.translate(i-v,e-y)},t}();t.Converter=r;var s=function(){function t(t){this.outPath=app.project.file.path+"/svga_works",this.converter=t}return t.prototype.write=function(){this.createOutputDirectories(),this.copyImages(),this.writeSpec()},t.prototype.createOutputDirectories=function(){new Folder(this.outPath).create()},t.prototype.copyImages=function(){for(var t=File,r=0;r<this.converter.res.length;r++){var s=this.converter.res[r];new t(s.path).copy(new t(this.outPath+"/"+s.name.replace(/\.png/gi,"").replace(/ /gi,"")+".png"))}},t.prototype.writeSpec=function(){for(var t=File,r={ver:"1.0.1",movie:{viewBox:{width:this.converter.proj.width,height:this.converter.proj.height},fps:this.converter.proj.frameRate,frames:this.converter.proj.frameCount},images:{},sprites:[]},s=0;s<this.converter.res.length;s++){var o=this.converter.res[s];r.images[o.name.replace(/\.png/gi,"").replace(/ /gi,"")]=o.name.replace(/\.png/gi,"").replace(/ /gi,"")}for(var s=this.converter.layers.length-1;s>=0;s--){for(var o=this.converter.layers[s],p=[],i=0;i<this.converter.proj.frameCount;i++){var e={alpha:o.values.alpha[i],layout:o.values.layout[i],transform:o.values.matrix[i]};void 0!==e.alpha&&e.alpha<=0&&delete e.alpha,void 0!==e.layout&&0==e.layout.x&&0==e.layout.y&&0==e.layout.width&&0==e.layout.height&&delete e.layout,void 0!==e.transform&&1==e.transform.a&&0==e.transform.b&&0==e.transform.c&&1==e.transform.d&&0==e.transform.tx&&0==e.transform.ty&&delete e.transform,p.push(e)}r.sprites.push({imageKey:o.name.replace(/\.png/gi,"").replace(/ /gi,""),frames:p})}var a=new t(this.outPath+"/movie.spec");a.exists&&a.remove(),a.encoding="UTF-8",a.open("e","TEXT","????"),a.write(JSON.stringify(r)),a.close()},t}();t.Writer=s}(SVGA||(SVGA={}));var converter=new SVGA.Converter(app),writer=new SVGA.Writer(converter);writer.write();