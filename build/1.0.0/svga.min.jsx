var Matrix=function(){function t(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function r(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1)}function s(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(1,0,0,0,0,r,-s,0,0,s,r,0,0,0,0,1)}function o(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,0,s,0,0,1,0,0,-s,0,r,0,0,0,0,1)}function p(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1)}function e(t,r){return this._t(1,r,t,1,0,0)}function i(t,r){return this.shear(Math.tan(t),Math.tan(r))}function a(t,r){var s=Math.cos(r),o=Math.sin(r);return this._t(s,o,0,0,-o,s,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1)._t(s,-o,0,0,o,s,0,0,0,0,1,0,0,0,0,1)}function h(t,r,s){return s=isNaN(s)?1:s,1==t&&1==r&&1==s?this:this._t(t,0,0,0,0,r,0,0,0,0,s,0,0,0,0,1)}function n(t,r,s,o,p,e,i,a,h,n,u,c,f,l,m,v){return this.props[0]=t,this.props[1]=r,this.props[2]=s,this.props[3]=o,this.props[4]=p,this.props[5]=e,this.props[6]=i,this.props[7]=a,this.props[8]=h,this.props[9]=n,this.props[10]=u,this.props[11]=c,this.props[12]=f,this.props[13]=l,this.props[14]=m,this.props[15]=v,this}function u(t,r,s){return s=isNaN(s)?0:s,0!==t||0!==r||0!==s?this._t(1,0,0,0,0,1,0,0,0,0,1,0,t,r,s,1):this}function c(t,r,s,o,p,e,i,a,h,n,u,c,f,l,m,v){if(1===t&&0===r&&0===s&&0===o&&0===p&&1===e&&0===i&&0===a&&0===h&&0===n&&1===u&&0===c)return 0===f&&0===l&&0===m||(this.props[12]=this.props[12]*t+this.props[13]*p+this.props[14]*h+this.props[15]*f,this.props[13]=this.props[12]*r+this.props[13]*e+this.props[14]*n+this.props[15]*l,this.props[14]=this.props[12]*s+this.props[13]*i+this.props[14]*u+this.props[15]*m,this.props[15]=this.props[12]*o+this.props[13]*a+this.props[14]*c+this.props[15]*v),this;var d=this.props[0],y=this.props[1],g=this.props[2],x=this.props[3],M=this.props[4],j=this.props[5],w=this.props[6],S=this.props[7],T=this.props[8],P=this.props[9],b=this.props[10],_=this.props[11],A=this.props[12],O=this.props[13],k=this.props[14],N=this.props[15];return this.props[0]=d*t+y*p+g*h+x*f,this.props[1]=d*r+y*e+g*n+x*l,this.props[2]=d*s+y*i+g*u+x*m,this.props[3]=d*o+y*a+g*c+x*v,this.props[4]=M*t+j*p+w*h+S*f,this.props[5]=M*r+j*e+w*n+S*l,this.props[6]=M*s+j*i+w*u+S*m,this.props[7]=M*o+j*a+w*c+S*v,this.props[8]=T*t+P*p+b*h+_*f,this.props[9]=T*r+P*e+b*n+_*l,this.props[10]=T*s+P*i+b*u+_*m,this.props[11]=T*o+P*a+b*c+_*v,this.props[12]=A*t+O*p+k*h+N*f,this.props[13]=A*r+O*e+k*n+N*l,this.props[14]=A*s+O*i+k*u+N*m,this.props[15]=A*o+O*a+k*c+N*v,this}function f(t){var r;for(r=0;r<16;r+=1)t.props[r]=this.props[r]}function l(t){var r;for(r=0;r<16;r+=1)this.props[r]=t[r]}function m(t,r,s){return{x:t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12],y:t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13],z:t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]}}function v(t,r,s){return t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12]}function d(t,r,s){return t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13]}function y(t,r,s){return t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]}function g(t,r,s){return[t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12],t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13],t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]]}function x(t,r){return bm_rnd(t*this.props[0]+r*this.props[4]+this.props[12])+","+bm_rnd(t*this.props[1]+r*this.props[5]+this.props[13])}function M(){return[this.props[0],this.props[1],this.props[2],this.props[3],this.props[4],this.props[5],this.props[6],this.props[7],this.props[8],this.props[9],this.props[10],this.props[11],this.props[12],this.props[13],this.props[14],this.props[15]]}function j(){return isSafari?"matrix3d("+roundTo2Decimals(this.props[0])+","+roundTo2Decimals(this.props[1])+","+roundTo2Decimals(this.props[2])+","+roundTo2Decimals(this.props[3])+","+roundTo2Decimals(this.props[4])+","+roundTo2Decimals(this.props[5])+","+roundTo2Decimals(this.props[6])+","+roundTo2Decimals(this.props[7])+","+roundTo2Decimals(this.props[8])+","+roundTo2Decimals(this.props[9])+","+roundTo2Decimals(this.props[10])+","+roundTo2Decimals(this.props[11])+","+roundTo2Decimals(this.props[12])+","+roundTo2Decimals(this.props[13])+","+roundTo2Decimals(this.props[14])+","+roundTo2Decimals(this.props[15])+")":(this.cssParts[1]=this.props.join(","),this.cssParts.join(""))}function w(){return"matrix("+this.props[0]+","+this.props[1]+","+this.props[4]+","+this.props[5]+","+this.props[12]+","+this.props[13]+")"}function S(){return""+this.toArray()}return function(){this.reset=t,this.rotate=r,this.rotateX=s,this.rotateY=o,this.rotateZ=p,this.skew=i,this.skewFromAxis=a,this.shear=e,this.scale=h,this.setTransform=n,this.translate=u,this.transform=c,this.applyToPoint=m,this.applyToX=v,this.applyToY=d,this.applyToZ=y,this.applyToPointArray=g,this.applyToPointStringified=x,this.toArray=M,this.toCSS=j,this.to2dCSS=w,this.toString=S,this.clone=f,this.cloneFromProps=l,this._t=this.transform,this.props=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.cssParts=["matrix3d(","",")"]}}();"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var r=meta[t];return"string"==typeof r?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,r){var s,o,p,e,i,a=gap,h=r[t];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(t)),"function"==typeof rep&&(h=rep.call(r,t,h)),typeof h){case"string":return quote(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(h)){for(e=h.length,s=0;s<e;s+=1)i[s]=str(s,h)||"null";return p=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+a+"]":"["+i.join(",")+"]",gap=a,p}if(rep&&"object"==typeof rep)for(e=rep.length,s=0;s<e;s+=1)"string"==typeof rep[s]&&(o=rep[s],p=str(o,h),p&&i.push(quote(o)+(gap?": ":":")+p));else for(o in h)Object.prototype.hasOwnProperty.call(h,o)&&(p=str(o,h),p&&i.push(quote(o)+(gap?": ":":")+p));return p=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+a+"}":"{"+i.join(",")+"}",gap=a,p}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,r,s){var o;if(gap="",indent="","number"==typeof s)for(o=0;o<s;o+=1)indent+=" ";else"string"==typeof s&&(indent=s);if(rep=r,r&&"function"!=typeof r&&("object"!=typeof r||"number"!=typeof r.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,r){var s,o,p=t[r];if(p&&"object"==typeof p)for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(o=walk(p,s),void 0!==o?p[s]=o:delete p[s]);return reviver.call(t,r,p)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var SVGA;!function(t){var r=function(){function t(t){this.app=void 0,this.proj=void 0,this.res=[],this.layers=[],this.app=t,this.loadProj(),this.loadRes(t.project.activeItem.layers,t.project.activeItem.layers.length),this.loadLayer(t.project.activeItem.layers,t.project.activeItem.layers.length,void 0,void 0,void 0)}return t.prototype.loadProj=function(){this.proj={name:this.app.project.activeItem.name,width:this.app.project.activeItem.width,height:this.app.project.activeItem.height,frameRate:this.app.project.activeItem.frameRate,frameCount:this.app.project.activeItem.frameRate*this.app.project.activeItem.duration}},t.prototype.loadRes=function(t,r){for(var s=1;s<=t.length;s++){var o=t[s];o.enabled!==!1&&(o.source&&o.source.file?this.res.push({name:o.source.name,path:o.source.file.fsName}):o.source.numLayers>0&&this.loadRes(o.source.layers,o.source.numLayers))}},t.prototype.loadLayer=function(t,r,s,o,p){for(var e=1;e<=r;e++){var i=t[e];i.enabled!==!1&&(i.source&&i.source.file?s?this.layers.push({name:i.source.name,values:this.concatValues(s,{alpha:this.requestAlpha(i.transform.opacity,i.inPoint,i.outPoint),layout:this.requestLayout(i.width,i.height),matrix:this.requestMatrix(i.transform,i.width,i.height),mask:this.requestMask(i)},i.width,i.height,o,p)}):this.layers.push({name:i.source.name,values:{alpha:this.requestAlpha(i.transform.opacity,i.inPoint,i.outPoint),layout:this.requestLayout(i.width,i.height),matrix:this.requestMatrix(i.transform,i.width,i.height),mask:this.requestMask(i)}}):i.source.numLayers>0&&this.loadLayer(i.source.layers,i.source.numLayers,{alpha:this.requestAlpha(i.transform.opacity,i.inPoint,i.outPoint),layout:this.requestLayout(i.width,i.height),matrix:this.requestMatrix(i.transform,i.width,i.height),mask:[this.requestMask(i)]},i.inPoint,i.outPoint))}},t.prototype.concatValues=function(t,r,s,o,p,e){var i=JSON.parse(JSON.stringify(t)),a=Math.min(p,e),h=Math.round(a/(1/this.proj.frameRate));h<0&&(h=0);for(var n=h,u=0;u<r.alpha.length;n++,u++)i.alpha[n]=r.alpha[u]*t.alpha[n];for(var n=h,u=0;u<r.layout.length;n++,u++)i.layout[n]=r.layout[u];for(var n=h,u=0;u<r.mask.length;n++,u++)i.mask[n]=r.mask[u];for(var n=h,u=0;u<r.matrix.length&&n<t.matrix.length;n++,u++){var c=new Matrix;c.reset(),c.transform(r.matrix[u].a,r.matrix[u].b,0,0,r.matrix[u].c,r.matrix[u].d,0,0,0,0,0,0,r.matrix[u].tx,r.matrix[u].ty,0,0),c.transform(t.matrix[n].a,t.matrix[n].b,0,0,t.matrix[n].c,t.matrix[n].d,0,0,0,0,0,0,0,0,0,0),i.matrix[n]={a:c.props[0],b:c.props[1],c:c.props[4],d:c.props[5],tx:c.props[12]+t.matrix[n].tx,ty:c.props[13]+t.matrix[n].ty}}for(var f=0;f<h;f++)delete i.alpha[f],delete i.layout[f],delete i.matrix[f],delete i.mask[f];return i},t.prototype.requestAlpha=function(t,r,s){for(var o=[],p=1/this.proj.frameRate,e=0;e<p*this.proj.frameCount;e+=p){if(r>s){if(e>r||e<s){o.push(0);continue}}else if(r<s&&(e<r||e>s)){o.push(0);continue}o.push(t.valueAtTime(e,!0)/100)}return o},t.prototype.requestMatrix=function(t,r,s){for(var o=[],p=1/this.proj.frameRate,e=0;e<p*this.proj.frameCount;e+=p){var i=t.Rotation.valueAtTime(e,!0),a=(t["Anchor Point"].valueAtTime(e,!0)[0],t["Anchor Point"].valueAtTime(e,!0)[1],t.Scale.valueAtTime(e,!0)[0]/100),h=t.Scale.valueAtTime(e,!0)[1]/100,n=t.Position.valueAtTime(e,!0)[0],u=t.Position.valueAtTime(e,!0)[1],c=new Matrix;c.reset().rotate(i*Math.PI/180).scale(a,h),this.convertMatrix(c,0,0,r,s,n,u),o.push({a:c.props[0],b:c.props[1],c:c.props[4],d:c.props[5],tx:c.props[12],ty:c.props[13]})}return o},t.prototype.requestLayout=function(t,r){for(var s=[],o=1/this.proj.frameRate,p=0;p<o*this.proj.frameCount;p+=o)s.push({x:0,y:0,width:t,height:r});return s},t.prototype.convertMatrix=function(t,r,s,o,p,e,i){var a=t.props[0]*r+t.props[4]*s+r,h=t.props[0]*(r+o)+t.props[4]*s+r,n=t.props[0]*r+t.props[4]*(s+p)+r,u=t.props[0]*(r+o)+t.props[4]*(s+p)+r,c=t.props[1]*r+t.props[5]*s+s,f=t.props[1]*(r+o)+t.props[5]*s+s,l=t.props[1]*r+t.props[5]*(s+p)+s,m=t.props[1]*(r+o)+t.props[5]*(s+p)+s,v=(Math.min(a,h,n,u)+Math.max(a,h,n,u))/2,d=(Math.min(c,f,l,m)+Math.max(c,f,l,m))/2;t.translate(e-v,i-d)},t.prototype.requestMask=function(t){if(t.mask.numProperties>0)for(var r=0;r<t.mask.numProperties;r++){for(var s=[],o=t.mask(r+1),p=o.property("maskShape").value,e=p.closed,i=o.inverted,a=(o.maskMode,1/this.proj.frameRate),h=0;h<a*this.proj.frameCount;h+=a){var n=o.property("maskShape").valueAtTime(h,!0).vertices,u="",c="",f="";i&&(u="M0,0 ",u+=" h"+t.width,u+=" v"+t.height,u+=" h-"+t.width,u+=" v-"+t.height+" ");for(var l=void 0,r=0;r<n.length;r++){var m=n[r];void 0===l?(c+=" M"+Math.round(m[0])+","+Math.round(m[1]),l=m):(c+=" C"+Math.round(l[0])+","+Math.round(l[1])+" "+Math.round(m[0])+","+Math.round(m[1])+" "+Math.round(m[0])+","+Math.round(m[1]),l=m)}e&&(c+=" C"+Math.round(l[0])+","+Math.round(l[1])+" "+Math.round(n[0][0])+","+Math.round(n[0][1])+" "+Math.round(n[0][0])+","+Math.round(n[0][1])),f=i?u+c:c,s.push(f)}return s}return[]},t}();t.Converter=r;var s=function(){function t(t){this.outPath=app.project.file.path+"/svga_works",this.converter=t}return t.prototype.write=function(){this.createOutputDirectories(),this.copyImages(),this.writeSpec()},t.prototype.createOutputDirectories=function(){new Folder(this.outPath).create()},t.prototype.copyImages=function(){for(var t=File,r=0;r<this.converter.res.length;r++){var s=this.converter.res[r];new t(s.path).copy(new t(this.outPath+"/"+s.name.replace(/\.png/gi,"").replace(/ /gi,"")+".png"))}},t.prototype.writeSpec=function(){for(var t=File,r={ver:"1.0.1",movie:{viewBox:{width:this.converter.proj.width,height:this.converter.proj.height},fps:this.converter.proj.frameRate,frames:this.converter.proj.frameCount},images:{},sprites:[]},s=0;s<this.converter.res.length;s++){var o=this.converter.res[s];r.images[o.name.replace(/\.png/gi,"").replace(/ /gi,"")]=o.name.replace(/\.png/gi,"").replace(/ /gi,"")}for(var s=this.converter.layers.length-1;s>=0;s--){for(var o=this.converter.layers[s],p=[],e=0;e<this.converter.proj.frameCount;e++){var i={alpha:o.values.alpha[e],layout:o.values.layout[e],transform:o.values.matrix[e],clipPath:o.values.mask[e]};void 0!==i.alpha&&i.alpha<=0&&delete i.alpha,void 0!==i.layout&&0==i.layout.x&&0==i.layout.y&&0==i.layout.width&&0==i.layout.height&&delete i.layout,void 0!==i.transform&&1==i.transform.a&&0==i.transform.b&&0==i.transform.c&&1==i.transform.d&&0==i.transform.tx&&0==i.transform.ty&&delete i.transform,void 0!==i.clipPath&&"string"==typeof i.clipPath&&""!==i.clipPath||delete i.clipPath,p.push(i)}r.sprites.push({imageKey:o.name.replace(/\.png/gi,"").replace(/ /gi,""),frames:p})}var a=new t(this.outPath+"/movie.spec");a.exists&&a.remove(),a.encoding="UTF-8",a.open("e","TEXT","????"),a.write(JSON.stringify(r)),a.close()},t}();t.Writer=s}(SVGA||(SVGA={}));var converter=new SVGA.Converter(app),writer=new SVGA.Writer(converter);writer.write();