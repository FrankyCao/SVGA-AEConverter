var Matrix=function(){function t(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function r(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1)}function s(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(1,0,0,0,0,r,-s,0,0,s,r,0,0,0,0,1)}function o(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,0,s,0,0,1,0,0,-s,0,r,0,0,0,0,1)}function p(t){if(0===t)return this;var r=Math.cos(t),s=Math.sin(t);return this._t(r,-s,0,0,s,r,0,0,0,0,1,0,0,0,0,1)}function e(t,r){return this._t(1,r,t,1,0,0)}function i(t,r){return this.shear(Math.tan(t),Math.tan(r))}function h(t,r){var s=Math.cos(r),o=Math.sin(r);return this._t(s,o,0,0,-o,s,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1)._t(s,-o,0,0,o,s,0,0,0,0,1,0,0,0,0,1)}function a(t,r,s){return s=isNaN(s)?1:s,1==t&&1==r&&1==s?this:this._t(t,0,0,0,0,r,0,0,0,0,s,0,0,0,0,1)}function n(t,r,s,o,p,e,i,h,a,n,u,c,f,l,m,v){return this.props[0]=t,this.props[1]=r,this.props[2]=s,this.props[3]=o,this.props[4]=p,this.props[5]=e,this.props[6]=i,this.props[7]=h,this.props[8]=a,this.props[9]=n,this.props[10]=u,this.props[11]=c,this.props[12]=f,this.props[13]=l,this.props[14]=m,this.props[15]=v,this}function u(t,r,s){return s=isNaN(s)?0:s,0!==t||0!==r||0!==s?this._t(1,0,0,0,0,1,0,0,0,0,1,0,t,r,s,1):this}function c(t,r,s,o,p,e,i,h,a,n,u,c,f,l,m,v){if(1===t&&0===r&&0===s&&0===o&&0===p&&1===e&&0===i&&0===h&&0===a&&0===n&&1===u&&0===c)return 0===f&&0===l&&0===m||(this.props[12]=this.props[12]*t+this.props[13]*p+this.props[14]*a+this.props[15]*f,this.props[13]=this.props[12]*r+this.props[13]*e+this.props[14]*n+this.props[15]*l,this.props[14]=this.props[12]*s+this.props[13]*i+this.props[14]*u+this.props[15]*m,this.props[15]=this.props[12]*o+this.props[13]*h+this.props[14]*c+this.props[15]*v),this;var y=this.props[0],g=this.props[1],d=this.props[2],x=this.props[3],j=this.props[4],w=this.props[5],S=this.props[6],T=this.props[7],_=this.props[8],b=this.props[9],A=this.props[10],O=this.props[11],M=this.props[12],N=this.props[13],D=this.props[14],P=this.props[15];return this.props[0]=y*t+g*p+d*a+x*f,this.props[1]=y*r+g*e+d*n+x*l,this.props[2]=y*s+g*i+d*u+x*m,this.props[3]=y*o+g*h+d*c+x*v,this.props[4]=j*t+w*p+S*a+T*f,this.props[5]=j*r+w*e+S*n+T*l,this.props[6]=j*s+w*i+S*u+T*m,this.props[7]=j*o+w*h+S*c+T*v,this.props[8]=_*t+b*p+A*a+O*f,this.props[9]=_*r+b*e+A*n+O*l,this.props[10]=_*s+b*i+A*u+O*m,this.props[11]=_*o+b*h+A*c+O*v,this.props[12]=M*t+N*p+D*a+P*f,this.props[13]=M*r+N*e+D*n+P*l,this.props[14]=M*s+N*i+D*u+P*m,this.props[15]=M*o+N*h+D*c+P*v,this}function f(t){var r;for(r=0;r<16;r+=1)t.props[r]=this.props[r]}function l(t){var r;for(r=0;r<16;r+=1)this.props[r]=t[r]}function m(t,r,s){return{x:t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12],y:t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13],z:t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]}}function v(t,r,s){return t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12]}function y(t,r,s){return t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13]}function g(t,r,s){return t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]}function d(t,r,s){return[t*this.props[0]+r*this.props[4]+s*this.props[8]+this.props[12],t*this.props[1]+r*this.props[5]+s*this.props[9]+this.props[13],t*this.props[2]+r*this.props[6]+s*this.props[10]+this.props[14]]}function x(t,r){return bm_rnd(t*this.props[0]+r*this.props[4]+this.props[12])+","+bm_rnd(t*this.props[1]+r*this.props[5]+this.props[13])}function j(){return[this.props[0],this.props[1],this.props[2],this.props[3],this.props[4],this.props[5],this.props[6],this.props[7],this.props[8],this.props[9],this.props[10],this.props[11],this.props[12],this.props[13],this.props[14],this.props[15]]}function w(){return isSafari?"matrix3d("+roundTo2Decimals(this.props[0])+","+roundTo2Decimals(this.props[1])+","+roundTo2Decimals(this.props[2])+","+roundTo2Decimals(this.props[3])+","+roundTo2Decimals(this.props[4])+","+roundTo2Decimals(this.props[5])+","+roundTo2Decimals(this.props[6])+","+roundTo2Decimals(this.props[7])+","+roundTo2Decimals(this.props[8])+","+roundTo2Decimals(this.props[9])+","+roundTo2Decimals(this.props[10])+","+roundTo2Decimals(this.props[11])+","+roundTo2Decimals(this.props[12])+","+roundTo2Decimals(this.props[13])+","+roundTo2Decimals(this.props[14])+","+roundTo2Decimals(this.props[15])+")":(this.cssParts[1]=this.props.join(","),this.cssParts.join(""))}function S(){return"matrix("+this.props[0]+","+this.props[1]+","+this.props[4]+","+this.props[5]+","+this.props[12]+","+this.props[13]+")"}function T(){return""+this.toArray()}return function(){this.reset=t,this.rotate=r,this.rotateX=s,this.rotateY=o,this.rotateZ=p,this.skew=i,this.skewFromAxis=h,this.shear=e,this.scale=a,this.setTransform=n,this.translate=u,this.transform=c,this.applyToPoint=m,this.applyToX=v,this.applyToY=y,this.applyToZ=g,this.applyToPointArray=d,this.applyToPointStringified=x,this.toArray=j,this.toCSS=w,this.to2dCSS=S,this.toString=T,this.clone=f,this.cloneFromProps=l,this._t=this.transform,this.props=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.cssParts=["matrix3d(","",")"]}}();"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var r=meta[t];return"string"==typeof r?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,r){var s,o,p,e,i,h=gap,a=r[t];switch(a&&"object"==typeof a&&"function"==typeof a.toJSON&&(a=a.toJSON(t)),"function"==typeof rep&&(a=rep.call(r,t,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(a)){for(e=a.length,s=0;s<e;s+=1)i[s]=str(s,a)||"null";return p=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+h+"]":"["+i.join(",")+"]",gap=h,p}if(rep&&"object"==typeof rep)for(e=rep.length,s=0;s<e;s+=1)"string"==typeof rep[s]&&(o=rep[s],p=str(o,a),p&&i.push(quote(o)+(gap?": ":":")+p));else for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(p=str(o,a),p&&i.push(quote(o)+(gap?": ":":")+p));return p=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+h+"}":"{"+i.join(",")+"}",gap=h,p}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,r,s){var o;if(gap="",indent="","number"==typeof s)for(o=0;o<s;o+=1)indent+=" ";else"string"==typeof s&&(indent=s);if(rep=r,r&&"function"!=typeof r&&("object"!=typeof r||"number"!=typeof r.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,r){var s,o,p=t[r];if(p&&"object"==typeof p)for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(o=walk(p,s),void 0!==o?p[s]=o:delete p[s]);return reviver.call(t,r,p)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var SVGA;!function(t){var r=function(){function t(t){this.app=void 0,this.proj=void 0,this.res=[],this.layers=[],this.app=t,this.loadProj(),this.loadRes(t.project.activeItem.layers,t.project.activeItem.layers.length),this.loadLayer(t.project.activeItem.layers,t.project.activeItem.layers.length,void 0)}return t.prototype.loadProj=function(){this.proj={name:this.app.project.activeItem.name,width:this.app.project.activeItem.width,height:this.app.project.activeItem.height,frameRate:this.app.project.activeItem.frameRate,frameCount:this.app.project.activeItem.frameRate*this.app.project.activeItem.duration}},t.prototype.loadRes=function(t,r){for(var s=1;s<=t.length;s++){var o=t[s];o.enabled!==!1&&(o.source&&o.source.file?this.res.push({name:o.source.name,path:o.source.file.fsName}):o.source.numLayers>0&&this.loadRes(o.source.layers,o.source.numLayers))}},t.prototype.loadLayer=function(t,r,s){for(var o=1;o<=r;o++){var p=t[o];p.enabled!==!1&&(p.source&&p.source.file?s?this.layers.push({name:p.source.name,values:this.concatValues({alpha:this.requestAlpha(p.transform.opacity),layout:this.requestLayout(p.width,p.height),matrix:this.requestMatrix(p.transform,p.width,p.height)},s)}):this.layers.push({name:p.source.name,values:{alpha:this.requestAlpha(p.transform.opacity),layout:this.requestLayout(p.width,p.height),matrix:this.requestMatrix(p.transform,p.width,p.height)}}):p.source.numLayers>0&&this.loadLayer(p.source.layers,p.source.numLayers,{alpha:this.requestAlpha(p.transform.opacity),layout:this.requestLayout(p.width,p.height),matrix:this.requestMatrix(p.transform,p.width,p.height)}))}},t.prototype.concatValues=function(t,r){for(var s=0;s<t.length;s++)void 0!==r[s].alpha&&(t[s].alpha=t[s].alpha*r[s].alpha),void 0!==r[s].alpha&&(t[s].alpha=t[s].alpha*r[s].alpha);return t},t.prototype.requestAlpha=function(t){for(var r=[],s=1/this.proj.frameRate,o=0;o<s*this.proj.frameCount;o+=s)r.push(t.valueAtTime(o,!0)/100);return r},t.prototype.requestMatrix=function(t,r,s){for(var o=[],p=1/this.proj.frameRate,e=0;e<p*this.proj.frameCount;e+=p){var i=t.Rotation.valueAtTime(e,!0),h=t["Anchor Point"].valueAtTime(e,!0)[0],a=t["Anchor Point"].valueAtTime(e,!0)[1],n=t.Scale.valueAtTime(e,!0)[0]/100,u=t.Scale.valueAtTime(e,!0)[1]/100,c=t.Position.valueAtTime(e,!0)[0],f=t.Position.valueAtTime(e,!0)[1],l=new Matrix;l.reset().rotate(i*Math.PI/180).scale(n,u),this.convertMatrix(l,h,a,n,u,c,f),o.push({a:l.props[0],b:l.props[1],c:l.props[4],d:l.props[5],tx:l.props[12],ty:l.props[13]})}return o},t.prototype.requestLayout=function(t,r){for(var s=[],o=1/this.proj.frameRate,p=0;p<o*this.proj.frameCount;p+=o)s.push({x:0,y:0,width:t,height:r});return s},t.prototype.convertMatrix=function(t,r,s,o,p,e,i){t.translate(e-r*o,i-s*p)},t}();t.Converter=r;var s=function(){function t(t){this.outPath=app.project.file.path+"/svga_works",this.converter=t}return t.prototype.write=function(){this.createOutputDirectories(),this.copyImages(),this.writeSpec()},t.prototype.createOutputDirectories=function(){new Folder(this.outPath).create()},t.prototype.copyImages=function(){for(var t=File,r=0;r<this.converter.res.length;r++){var s=this.converter.res[r];new t(s.path).copy(new t(this.outPath+"/"+s.name.replace(/\.png/gi,"").replace(/ /gi,"")+".png"))}},t.prototype.writeSpec=function(){for(var t=File,r={ver:"1.0.1",movie:{viewBox:{width:this.converter.proj.width,height:this.converter.proj.height},fps:this.converter.proj.frameRate,frames:this.converter.proj.frameCount},images:{},sprites:[]},s=0;s<this.converter.res.length;s++){var o=this.converter.res[s];r.images[o.name.replace(/\.png/gi,"").replace(/ /gi,"")]=o.name.replace(/\.png/gi,"").replace(/ /gi,"")}for(var s=this.converter.layers.length-1;s>=0;s--){for(var o=this.converter.layers[s],p=[],e=0;e<this.converter.proj.frameCount;e++){var i={alpha:o.values.alpha[e],layout:o.values.layout[e],transform:o.values.matrix[e]};i.alpha<=0&&delete i.alpha,0==i.layout.x&&0==i.layout.y&&0==i.layout.width&&0==i.layout.height&&delete i.layout,1==i.transform.a&&0==i.transform.b&&0==i.transform.c&&1==i.transform.d&&0==i.transform.tx&&0==i.transform.ty&&delete i.transform,p.push(i)}r.sprites.push({imageKey:o.name.replace(/\.png/gi,"").replace(/ /gi,""),frames:p})}var h=new t(this.outPath+"/movie.spec");h.exists&&h.remove(),h.encoding="UTF-8",h.open("e","TEXT","????"),h.write(JSON.stringify(r)),h.close()},t}();t.Writer=s}(SVGA||(SVGA={}));var converter=new SVGA.Converter(app),writer=new SVGA.Writer(converter);writer.write();